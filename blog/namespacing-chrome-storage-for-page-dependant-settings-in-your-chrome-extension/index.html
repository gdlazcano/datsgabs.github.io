<!doctype html><html lang=en prefix="og: http://ogp.me/ns#"><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="Gabriel Lazcano"><title>Namespacing Chrome Storage for page dependant settings for your Chrome Extension</title><meta name=twitter:card content="summary"><meta name=twitter:site content="@datsgabs"><meta name=twitter:creator content="@datsgabs"><meta name=twitter:image content="https://gabriellazcano.com/images/habbo-card.png"><meta property="og:title" content="Namespacing Chrome Storage for page dependant settings for your Chrome Extension"><meta property="og:description" content="A tutorial of how to namespace chrome.storage for making it dependant on the current page"><meta property="og:type" content="article"><meta property="og:image" content="https://gabriellazcano.com/images/habbo-card.png"><meta property="og:locale" content="en_US"><meta property="og:url" content="https://gabriellazcano.com"><meta property="og:sitename" content="Gabriel Lazcano"><meta name=twitter:dnt content="on"><link rel="shortcut icon" href=/images/habbo-card.png type=image/png><link rel=stylesheet href=https://gabriellazcano.com/scss/commons/index.min.59d96cb292edfc7b1d292fefa6089742a0fea130b49c199a92e558868f802df6.css><link rel=stylesheet href=https://gabriellazcano.com/scss/single/index.min.43243fd98d6d4ecd9b5f476a74415df34312f485c4c4e9ee80e4d1002a455147.css></head><body><div class=container><nav class=navigation><a class=navigation_home-button href=/ title="Press to go Home"><img width=80 height=80 src=/images/habbo.png alt="Gabriel Lazcano"></a><h1 class="navigation_header navigation_mobile--hiden">Gabriel Lazcano</h1><p class=navigation_mobile--hiden>Fullstack web developer, living in Mexico</p><div class="social-media navigation_mobile--hiden"><a href=https://github.com/datsgabs><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub icon</title><path d="M12 .297c-6.63.0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577.0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93.0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176.0.0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22.0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22.0 1.606-.015 2.896-.015 3.286.0.315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a><a href=https://twitter.com/datsgabs><svg role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><title>Twitter icon</title><path d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958.0 002.163-2.723c-.951.555-2.005.959-3.127 1.184A4.92 4.92.0 0011.78 8.288C7.69 8.095 4.067 6.13 1.64 3.162A4.822 4.822.0 00.974 5.637c0 1.71.87 3.213 2.188 4.096A4.904 4.904.0 01.934 9.117v.06a4.923 4.923.0 003.946 4.827 4.996 4.996.0 01-2.212.085 4.936 4.936.0 004.604 3.417A9.867 9.867.0 011.17 19.611c-.39.0-.779-.023-1.17-.067a13.995 13.995.0 007.557 2.209c9.053.0 13.998-7.496 13.998-13.985.0-.21.0-.42-.015-.63A9.935 9.935.0 0024 4.59z"/></svg></a><a href=/index.xml><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>RSS icon</title><path d="M19.199 24C19.199 13.467 10.533 4.8.0 4.8V0c13.165.0 24 10.835 24 24h-4.801zM3.291 17.415c1.814.0 3.293 1.479 3.293 3.295.0 1.813-1.485 3.29-3.301 3.29C1.47 24 0 22.526.0 20.71s1.475-3.294 3.291-3.295zM15.909 24h-4.665c0-6.169-5.075-11.245-11.244-11.245V8.09c8.727.0 15.909 7.184 15.909 15.91z"/></svg></a></div><div class=navigation_menu id=links><a href=/tags title>Tags</a>
<a href=/archive title>Archive</a>
<a href=/newsletter title>Newsletter</a><br><hr><br><small>© 2021 Gabriel Lazcano</small></div><div class=navigation_hamburger id=hamburger><div class="hamburger_line half start"></div><div class=hamburger_line></div><div class="hamburger_line half end"></div></div><script src=/js/hamburger-menu.min.2e543bcb3025aea643d9d2fede961bb233bbad382ccfcff590f4310085774c41.js defer></script></nav><main class=main><div class=single-header><h1 class=single-header_title>Namespacing Chrome Storage for page dependant settings for your Chrome Extension</h1><p class=title-footnote>Published on <b>Mar 3, 2021</b></p><p class=title-footnote>Reading time: <b>3 min</b></p></div><article id=article class=article><p>As far as I know <code>chrome.storage</code> saves it&rsquo;s keys globally, so it&rsquo;s not like <code>localstorage</code> on normal pages that gets only works in the current page. For that purpose I had to figure out a way of achieving this. So I decided using namespaces using template literals. This is a really made up process so there might be inaccuracies, feel free to let me know :)</p><h2 id=creating-the-extension>Creating the extension</h2><p>Creating the extension from scratch is pretty straightforward, we just have to add a <code>manifest.json</code> file with the following values:</p><blockquote><p><code>permissions</code> are needed for the sole purpose of this tutorial but could be not added</p></blockquote><div class=highlight><pre class=chroma><code class=language-json data-lang=json><span class=p>{</span>
    <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;[name of the extension]&#34;</span><span class=p>,</span>
    <span class=nt>&#34;version&#34;</span><span class=p>:</span> <span class=s2>&#34;1.0&#34;</span><span class=p>,</span>
    <span class=nt>&#34;manifest_version&#34;</span><span class=p>:</span> <span class=mi>3</span><span class=p>,</span>
    <span class=nt>&#34;permissions&#34;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&#34;storage&#34;</span><span class=p>,</span> <span class=s2>&#34;tabs&#34;</span><span class=p>],</span>
    <span class=nt>&#34;action&#34;</span><span class=p>:</span> <span class=p>{</span>
        <span class=nt>&#34;default_popup&#34;</span><span class=p>:</span> <span class=s2>&#34;popup.html&#34;</span>
    <span class=p>}</span>
<span class=p>}</span></code></pre></div><p>We have to create a <code>popup.html</code> file and just use it as if it was a normal HTML. We can import scripts add stylsheets, etc.</p><div class=highlight><pre class=chroma><code class=language-html data-lang=html><span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;container&#34;</span><span class=p>&gt;</span>
    <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;box &#34;</span><span class=p>&gt;&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
    <span class=p>&lt;</span><span class=nt>button</span> <span class=na>id</span><span class=o>=</span><span class=s>&#34;toggle&#34;</span><span class=p>&gt;</span>Toggle<span class=p>&lt;/</span><span class=nt>button</span><span class=p>&gt;</span>
<span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>

<span class=p>&lt;</span><span class=nt>script</span> <span class=na>src</span><span class=o>=</span><span class=s>&#34;popup.js&#34;</span><span class=p>&gt;&lt;/</span><span class=nt>script</span><span class=p>&gt;</span></code></pre></div><p>In the <code>popup.js</code> file is where we are going to have the logic for namespacing <code>chrome.storage</code> keys.</p><p>Firstly, I have to point out that <code>chrome.storage</code> is an <code>async</code> api therefore we will have to use <code>async/await</code> on our main function.</p><blockquote><p>If you are working with multiple variables I recommend using an object, as I did.</p></blockquote><div class=highlight><pre class=chroma><code class=language-javascript data-lang=javascript><span class=p>;(</span><span class=kr>async</span> <span class=kd>function</span> <span class=p>()</span> <span class=p>{</span>
    <span class=kd>let</span> <span class=nx>settings</span> <span class=o>=</span> <span class=p>{</span>
        <span class=nx>active</span><span class=o>:</span> <span class=kc>false</span>
    <span class=p>}</span>
    <span class=c1>// Gets the current URL of the tab
</span><span class=c1></span>    <span class=kr>const</span> <span class=nx>url</span> <span class=o>=</span> <span class=kr>await</span> <span class=k>new</span> <span class=nb>Promise</span><span class=p>((</span><span class=nx>res</span><span class=p>,</span> <span class=nx>rej</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
        <span class=nx>chrome</span><span class=p>.</span><span class=nx>tabs</span><span class=p>.</span><span class=nx>query</span><span class=p>({</span> <span class=nx>active</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span> <span class=nx>lastFocusedWindow</span><span class=o>:</span> <span class=kc>true</span> <span class=p>},</span> <span class=p>(</span><span class=nx>tabs</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
            <span class=kd>let</span> <span class=nx>url</span> <span class=o>=</span> <span class=nx>tabs</span><span class=p>[</span><span class=mi>0</span><span class=p>].</span><span class=nx>url</span>
            <span class=nx>res</span><span class=p>(</span><span class=nx>url</span><span class=p>)</span>
        <span class=p>})</span>
    <span class=p>})</span>

    <span class=c1>// Gets chrome storage with the namespace URL
</span><span class=c1></span>    <span class=kr>const</span> <span class=nx>synchedSettings</span> <span class=o>=</span> <span class=kr>await</span> <span class=k>new</span> <span class=nb>Promise</span><span class=p>((</span><span class=nx>res</span><span class=p>,</span> <span class=nx>rej</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
        <span class=nx>chrome</span><span class=p>.</span><span class=nx>storage</span><span class=p>.</span><span class=nx>sync</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=sb>`settings:</span><span class=si>${</span><span class=nx>url</span><span class=si>}</span><span class=sb>`</span><span class=p>,</span> <span class=p>(</span><span class=nx>results</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
            <span class=nx>res</span><span class=p>(</span><span class=nb>Object</span><span class=p>.</span><span class=nx>values</span><span class=p>(</span><span class=nx>results</span><span class=p>)[</span><span class=mi>0</span><span class=p>])</span>
        <span class=p>})</span>
    <span class=p>})</span>

    <span class=k>if</span> <span class=p>(</span><span class=nx>synchedSettings</span><span class=p>)</span> <span class=p>{</span>
        <span class=nx>settings</span> <span class=o>=</span> <span class=nx>synchedSettings</span>
        <span class=nx>handleToggleButton</span><span class=p>(</span><span class=nx>settings</span><span class=p>.</span><span class=nx>active</span><span class=p>)</span>
    <span class=p>}</span>
<span class=p>})()</span></code></pre></div><p>Here we are using the <code>tab</code> API, that we enabled before in the <code>manifest</code>, to get the URL of the current page and we wait for the <code>Promise</code> to resolve. Then we use the <code>storage</code> api and use a template literal to get the settings only from the current URL. As we have no real way of getting the key from the results, we just resolve the first element in the <code>Object.values()</code> that returns an array of all the keys in the <code>results</code> which in this case is the <code>settings</code> object we want. Then we substitute the default <code>settings</code> object with the one we got from <code>storage</code>. <strong>To conclude, it works.</strong></p><p>To set up a new element we have to set the <code>addEventListener</code> inside the <code>async function</code> as we&rsquo;ll need the URL for setting up the namespace.</p><div class=highlight><pre class=chroma><code class=language-javascript data-lang=javascript><span class=kr>const</span> <span class=nx>toggleButton</span> <span class=o>=</span> <span class=nb>document</span><span class=p>.</span><span class=nx>querySelector</span><span class=p>(</span><span class=s2>&#34;#toggle&#34;</span><span class=p>)</span>
<span class=kr>const</span> <span class=nx>box</span> <span class=o>=</span> <span class=nb>document</span><span class=p>.</span><span class=nx>querySelector</span><span class=p>(</span><span class=s1>&#39;.box&#39;</span><span class=p>)</span>

<span class=c1>// Add class to .box depending of if it&#39;s active or not
</span><span class=c1></span><span class=kd>function</span> <span class=nx>handleToggleButton</span><span class=p>(</span><span class=nx>active</span><span class=p>)</span> <span class=p>{</span>
    <span class=k>if</span> <span class=p>(</span><span class=nx>active</span><span class=p>)</span> <span class=p>{</span>
        <span class=nx>box</span><span class=p>.</span><span class=nx>classList</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=s1>&#39;active&#39;</span><span class=p>)</span>
    <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
        <span class=nx>box</span><span class=p>.</span><span class=nx>classList</span><span class=p>.</span><span class=nx>remove</span><span class=p>(</span><span class=s1>&#39;active&#39;</span><span class=p>)</span>
    <span class=p>}</span>
<span class=p>}</span>

<span class=p>;(</span><span class=kr>async</span> <span class=kd>function</span> <span class=p>()</span> <span class=p>{</span>

    <span class=c1>// ...
</span><span class=c1></span>
    <span class=c1>// When toggle gets pressed changes settings.value value and saves it to storage with namespace
</span><span class=c1></span>    <span class=nx>toggleButton</span><span class=p>.</span><span class=nx>addEventListener</span><span class=p>(</span><span class=s2>&#34;click&#34;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
        <span class=nx>settings</span> <span class=o>=</span> <span class=p>{</span>
            <span class=nx>active</span><span class=o>:</span> <span class=o>!</span><span class=nx>settings</span><span class=p>.</span><span class=nx>active</span>
        <span class=p>}</span>
        <span class=nx>chrome</span><span class=p>.</span><span class=nx>storage</span><span class=p>.</span><span class=nx>sync</span><span class=p>.</span><span class=nx>set</span><span class=p>({</span> <span class=p>[</span><span class=sb>`settings:</span><span class=si>${</span><span class=nx>url</span><span class=si>}</span><span class=sb>`</span><span class=p>]</span><span class=o>:</span> <span class=nx>settings</span> <span class=p>},</span> <span class=kd>function</span> <span class=p>()</span> <span class=p>{</span>
            <span class=nx>handleToggleButton</span><span class=p>(</span><span class=nx>settings</span><span class=p>.</span><span class=nx>active</span><span class=p>)</span>
        <span class=p>})</span>
    <span class=p>})</span>
<span class=p>})()</span></code></pre></div><h3 id=add-chrome-extension>Add Chrome Extension</h3><p>You have to go to <code>chrome://extensions</code> and turn on Developer Mode. Press <code>Load unpacked</code> and select the directory where the extension is. In the screenshot I&rsquo;m using Brave Browser but it makes no difference.</p><p><img src=/images/blog/3.png alt=image></p><h2 id=wrap-up>Wrap up</h2><p>I hope you will find this blog post useful and keep it handy for a quick reference. This solution is a little clumsy but I didn&rsquo;t find any better way and wanted to share it with you. Feel free to send me a DM or to mention me on Twitter if you&rsquo;ve got any suggestion or fix.</p><p>You can look at the whole code in <a href=https://github.com/DatsGabs/namespace-chrome-storage-extension>this repository</a></p><a class=editPage href=https://github.com/DatsGabs/datsgabs.github.io/blob/main/content/blog/namespacing-chrome-storage-for-page-dependant-settings-in-your-chrome-extension.md><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 .297c-6.63.0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577.0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93.0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176.0.0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22.0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22.0 1.606-.015 2.896-.015 3.286.0.315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg>Edit this page on Github</a></article><div class=article-bottom><h2>Share this Article</h2><div class=share-buttons><a href="https://twitter.com/intent/tweet?text=Namespacing%20Chrome%20Storage%20for%20page%20dependant%20settings%20for%20your%20Chrome%20Extension&url=https%3a%2f%2fgabriellazcano.com%2fblog%2fnamespacing-chrome-storage-for-page-dependant-settings-in-your-chrome-extension%2f&via=datsgabs" target=_blank rel="noopener noreferrer" class="share-twitter-btn article-bottom_btn"><svg role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958.0 002.163-2.723c-.951.555-2.005.959-3.127 1.184A4.92 4.92.0 0011.78 8.288C7.69 8.095 4.067 6.13 1.64 3.162A4.822 4.822.0 00.974 5.637c0 1.71.87 3.213 2.188 4.096A4.904 4.904.0 01.934 9.117v.06a4.923 4.923.0 003.946 4.827 4.996 4.996.0 01-2.212.085 4.936 4.936.0 004.604 3.417A9.867 9.867.0 011.17 19.611c-.39.0-.779-.023-1.17-.067a13.995 13.995.0 007.557 2.209c9.053.0 13.998-7.496 13.998-13.985.0-.21.0-.42-.015-.63A9.935 9.935.0 0024 4.59z"/></svg><span>Tweet</span></a>
<a href="https://www.reddit.com/submit?title=Namespacing%20Chrome%20Storage%20for%20page%20dependant%20settings%20for%20your%20Chrome%20Extension&url=https%3a%2f%2fgabriellazcano.com%2fblog%2fnamespacing-chrome-storage-for-page-dependant-settings-in-your-chrome-extension%2f" class="share-reddit_btn article-bottom_btn" target=_blank><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 0A12 12 0 000 12a12 12 0 0012 12 12 12 0 0012-12A12 12 0 0012 0zm5.01 4.744c.688.0 1.25.561 1.25 1.249a1.25 1.25.0 01-2.498.056l-2.597-.547-.8 3.747c1.824.07 3.48.632 4.674 1.488.308-.309.73-.491 1.207-.491.968.0 1.754.786 1.754 1.754.0.716-.435 1.333-1.01 1.614a3.111 3.111.0 01.042.52c0 2.694-3.13 4.87-7.004 4.87s-7.004-2.176-7.004-4.87c0-.183.015-.366.043-.534A1.748 1.748.0 014.028 12c0-.968.786-1.754 1.754-1.754.463.0.898.196 1.207.49 1.207-.883 2.878-1.43 4.744-1.487l.885-4.182a.342.342.0 01.14-.197.35.35.0 01.238-.042l2.906.617a1.214 1.214.0 011.108-.701zM9.25 12C8.561 12 8 12.562 8 13.25c0 .687.561 1.248 1.25 1.248.687.0 1.248-.561 1.248-1.249S9.937 12 9.249 12zm5.5.0c-.687.0-1.248.561-1.248 1.25.0.687.561 1.248 1.249 1.248S16 13.937 16 13.249c0-.687-.562-1.249-1.25-1.249zm-5.466 3.99a.327.327.0 00-.231.094.33.33.0 000 .463c.842.842 2.484.913 2.961.913s2.105-.056 2.961-.913a.361.361.0 00.029-.463.33.33.0 00-.464.0c-.547.533-1.684.73-2.512.73-.828.0-1.979-.196-2.512-.73a.326.326.0 00-.232-.095z"/></svg>Reddit</a></div></div><div class=comments><h2>Comments</h2><script src=https://utteranc.es/client.js repo=DatsGabs/datsgabs.github.io issue-term=og:title theme=github-dark crossorigin=anonymous async loading=lazy></script><p id=commentsNotice>utteranc.es uses Github Issues, no data is stored.<br>You can disable it from your <a href=https://github.com/settings/apps/authorizations>authorized apps.</a></p></div><script>const commentsNotice=document.getElementById('commentsNotice'),observer=new MutationObserver((c,b)=>{const a=document.querySelector('.utterances-frame');if(a){a.addEventListener('load',()=>{setInterval(()=>{commentsNotice.style.opacity="100"},1e3)}),b.disconnect();return}});observer.observe(document,{childList:!0,subtree:!0})</script><div class=single_pagination><div class=pagination_title><span class=pagination_title-h>Read other posts</span></div><div class=pagination_buttons><span class="button previous"><a href=https://gabriellazcano.com/blog/easy-dark-mode-with-css-variables/><span class=button_icon>←</span>
<span class=button_text>Easy Dark Mode With CSS variables</span></a></span>
<span class="button next"><a href=https://gabriellazcano.com/blog/how-to-add-a-custom-domain-to-your-github-pages/><span class=button_text>How to Add a Custom Domain to Your Github Pages?</span>
<span class=button_icon>→</span></a></span></div></div></main><aside><div class=toc><nav id=TableOfContents><ul><li><a href=#creating-the-extension>Creating the extension</a><ul><li><a href=#add-chrome-extension>Add Chrome Extension</a></li></ul></li><li><a href=#wrap-up>Wrap up</a></li></ul></nav></div><script src=/js/toc.min.c2c0b342b7ac1aa639d23ba881fbeff32c69b60f4829dc22348110dc98be99fb.js></script></aside></div><script src=/js/clickable-box.min.bbd9f6756183352f2862ee000ab3f9c168fa3b03e076ef267e0eda619c45f960.js defer></script><script src=/js/index.min.a436abe5aff433351a616bc69213e540156f65138a3b6690d6bdf7a60df7ebe5.js defer></script></body></html>